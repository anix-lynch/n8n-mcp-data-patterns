#!/bin/bash\n\n# 🧹 Data Quality Audit Setup Script\n# Run this once to set up the data quality audit pattern\n\necho \"🚀 Setting up Data Quality Audit Pattern...\"\n\n# Create necessary directories\necho \"📁 Creating directories...\"\nmkdir -p /data/input\nmkdir -p /data/output\nmkdir -p /data/reports\n\n# Set permissions\nchmod 755 /data/input /data/output /data/reports\n\n# Install required packages (if using local Python)\necho \"📦 Installing dependencies...\"\nif command -v pip3 &> /dev/null; then\n    pip3 install pandas numpy scipy matplotlib seaborn\n    echo \"✅ Python packages installed\"\nelse\n    echo \"⚠️  Python not found - that's ok, n8n will handle the analysis\"\nfi\n\n# Download sample data if not exists\nif [ ! -f \"/data/input/sample-data.csv\" ]; then\n    echo \"📊 Creating sample dataset...\"\n    cat > /data/input/sample-data.csv << 'EOF'\nname,age,salary,department,performance_score,missing_field,years_experience\nAlice Johnson,28,75000,Engineering,4.2,,3\nBob Smith,35,95000,Engineering,4.8,,8\nCarol Davis,31,65000,Marketing,3.9,,5\nDavid Wilson,29,72000,Sales,4.1,,4\nEve Brown,33,88000,Engineering,4.6,Yes,7\nFrank Miller,27,58000,Marketing,3.5,,2\nGrace Lee,30,78000,Sales,4.3,Yes,6\nHenry Taylor,32,82000,Engineering,4.5,,9\nIvy Chen,26,62000,Marketing,3.8,,1\nJack Anderson,34,91000,Sales,4.7,Yes,12\nKaren White,29,69000,Marketing,3.7,,3\nLiam Garcia,31,85000,Engineering,4.4,,6\nMia Rodriguez,28,73000,Sales,4.0,,4\nNoah Martinez,33,89000,Engineering,4.6,,8\nOlivia Thompson,30,71000,Marketing,3.9,,5\nPeter Jackson,35,96000,Sales,4.8,Yes,10\nQuinn Hall,27,59000,Marketing,3.4,,2\nRachel Green,32,83000,Engineering,4.5,,7\nSam Turner,29,70000,Sales,4.1,,4\nTina Adams,31,77000,Engineering,4.3,,6\nUma Patel,28,64000,Marketing,3.8,,3\nVictor Kim,34,92000,Sales,4.7,Yes,11\nWendy Liu,30,75000,Engineering,4.2,,5\nXavier Scott,33,87000,Sales,4.6,,9\nYara Hassan,26,61000,Marketing,3.6,,1\nZoe Cooper,32,81000,Engineering,4.4,,7\nAlex Morgan,999,150000,Engineering,5.0,Yes,25\nSarah Connor,-5,0,Unknown,0.0,,0\nJohn Doe,,,,,,-1\nEOF\n    echo \"✅ Sample data created at /data/input/sample-data.csv\"\nfi\n\n# Set up environment variables\necho \"🔧 Setting up environment...\"\necho \"export DATA_INPUT_PATH=/data/input\" >> ~/.bashrc\necho \"export DATA_OUTPUT_PATH=/data/output\" >> ~/.bashrc\necho \"export REPORT_EMAIL=your-email@company.com\" >> ~/.bashrc\n\n# Create quick test command\necho \"🎯 Creating test commands...\"\necho \"#!/bin/bash\" > /usr/local/bin/test-quality-audit\necho \"# Create a test file to trigger the workflow\" >> /usr/local/bin/test-quality-audit\necho \"cp /data/input/sample-data.csv /data/input/test-\\$(date +%s).csv\" >> /usr/local/bin/test-quality-audit\necho \"echo '🎉 Test file created! Check your n8n workflow for automatic processing.'\" >> /usr/local/bin/test-quality-audit\necho \"echo '📁 File location: /data/input/test-\\$(date +%s).csv'\" >> /usr/local/bin/test-quality-audit\nchmod +x /usr/local/bin/test-quality-audit\n\n# Create directory structure info\necho \"📋 Creating directory info...\"\ncat > /data/README.md << 'EOF'\n# Data Quality Audit Directories\n\n## 📁 Directory Structure\n\n- `/data/input/` - Drop CSV files here for automatic processing\n- `/data/output/` - Processed results and reports\n- `/data/reports/` - Generated HTML reports\n\n## 🚀 Quick Start\n\n1. **Test the workflow:**\n   ```bash\n   test-quality-audit\n   ```\n\n2. **Process your own data:**\n   ```bash\n   cp your-file.csv /data/input/\n   ```\n\n3. **Monitor processing:**\n   ```bash\n   watch -n 2 \"ls -la /data/input/\"\n   ```\n\n## 📊 Sample Data Format\n\nYour CSV should have:\n- Headers in the first row\n- Consistent column structure\n- Any data types (numeric, text, dates)\n\nThe workflow will automatically:\n- ✅ Detect missing values\n- ✅ Identify outliers\n- ✅ Calculate quality scores\n- ✅ Generate recommendations\n- ✅ Send notifications\n\n## 🔧 Troubleshooting\n\n**File not processed?**\n- Check file permissions: `chmod 644 /data/input/your-file.csv`\n- Verify CSV format (comma-separated, UTF-8)\n- Check n8n logs for errors\n\n**Need to customize?**\n- Update email address in the n8n workflow\n- Modify Slack webhook URL\n- Adjust quality score thresholds\nEOF\n\necho \"✅ Setup complete!\"\necho \"\"\necho \"🎯 Next steps:\"\necho \"1. Import patterns/01-data-quality-audit.json into n8n\"\necho \"2. Update email address in the workflow (node: 📧 Email Report)\"\necho \"3. Update Slack webhook URL (node: 💬 Slack Alert) - optional\"\necho \"4. Run 'test-quality-audit' to test the pipeline\"\necho \"5. Place your CSV files in /data/input/ for automatic processing\"\necho \"\"\necho \"📚 Documentation: /data/README.md\"\necho \"📊 Sample data: /data/input/sample-data.csv\"\necho \"\"\necho \"🎉 Ready to audit some data! Drop a CSV in /data/input/ and watch the magic happen!\"\n"